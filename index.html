<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>実績管理（表示確認版）</title>
    <style>
        #pw_screen { position: fixed; top:0; left:0; width:100%; height:100%; background:#2d3748; color:white; display:flex; justify-content:center; align-items:center; z-index:1000; }
        #main_content { display:none; padding:20px; font-family:sans-serif; }
        table { width:100%; border-collapse:collapse; margin-top:20px; }
        th, td { border:1px solid #333; padding:8px; text-align:right; font-size:12px; }
        th { background:#f4f4f4; text-align:center; }
        .item-label { text-align:left; background:#eef; font-weight:bold; }
    </style>
</head>
<body>

<div id="pw_screen">
    <div style="background:white; color:black; padding:30px; border-radius:10px; text-align:center;">
        <h3>パスワードを入力してください</h3>
        <input type="password" id="pass_val" style="padding:10px; font-size:16px;">
        <button onclick="checkPW()" style="padding:10px 20px;">ログイン</button>
        <p id="err_msg" style="color:red; display:none;">パスワードが違います</p>
    </div>
</div>

<div id="main_content">
    <h2>営業実績・予算管理表（データ表示テスト）</h2>
    <div id="loading" style="color:blue;">データ取得中...</div>
    
    <table id="test-table">
        <thead>
            <tr>
                <th>項目</th><th>区分</th>
                <th>6月</th><th>7月</th><th>8月</th><th>9月</th><th>10月</th><th>11月</th>
                <th>12月</th><th>1月</th><th>2月</th><th>3月</th><th>4月</th><th>5月</th>
            </tr>
        </thead>
        <tbody id="table-body">
            </tbody>
    </table>
</div>

<script>
    const SHEET_ID = '1LRVwKu-YXWJvRgSophqF0VlORS5_dcjztSvfz95Qe_E';
    
    function checkPW() {
        if (document.getElementById('pass_val').value === "freeeks2022") {
            document.getElementById('pw_screen').style.display = 'none';
            document.getElementById('main_content').style.display = 'block';
            fetchData();
        } else {
            document.getElementById('err_msg').style.display = 'block';
        }
    }

    async function fetchData() {
        const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent('実績データ')}`;
        try {
            const response = await fetch(url);
            const csvText = await response.text();
            const rows = parseCSV(csvText);
            displayTable(rows);
        } catch (e) {
            alert('取得失敗');
            console.error(e);
        } finally {
            document.getElementById('loading').style.display = 'none';
        }
    }

    function parseCSV(text) {
        return text.split(/\r?\n/).map(line => {
            const res = []; let cur = '', q = false;
            for (let ch of line) {
                if (ch === '"') q = !q;
                else if (ch === ',' && !q) { res.push(cur.trim()); cur = ''; }
                else cur += ch;
            }
            res.push(cur.trim()); return res;
        });
    }

    function displayTable(rows) {
        const tbody = document.getElementById('table-body');
        tbody.innerHTML = '';

        // スプレッドシートの2行目から表示（ヘッダーを除外）
        rows.slice(1).forEach(row => {
            if (row.length < 5) return; // 空行スキップ

            const tr = document.createElement('tr');
            
            // 項目名と区分
            const itemCell = `<td class="item-label">${row[1]}</td>`;
            const typeCell = `<td style="text-align:center;">${row[2]}</td>`;
            
            // 6月〜5月のデータ
            let monthCells = '';
            for (let i = 3; i <= 14; i++) {
                let val = row[i] ? row[i].replace(/"/g, '') : '-';
                monthCells += `<td>${val}</td>`;
            }

            tr.innerHTML = itemCell + typeCell + monthCells;
            tbody.appendChild(tr);
        });

        if (tbody.innerHTML === '') {
            tbody.innerHTML = '<tr><td colspan="14" style="text-align:center;">データが見つかりませんでした</td></tr>';
        }
    }
</script>
</body>
</html>




