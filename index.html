<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>実績管理（接続確認版）</title>
    <style>
        body { font-family: sans-serif; margin: 20px; background: #f0f4f8; }
        #pw_screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #1a202c; display: flex; justify-content: center; align-items: center; z-index: 1000; }
        #pw_box { background: white; padding: 40px; border-radius: 12px; text-align: center; }
        #main_content { display: none; }
        table { width: 100%; border-collapse: collapse; background: white; margin-top: 20px; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; font-size: 13px; }
        th { background: #edf2f7; }
        .loading { color: #3182ce; font-weight: bold; }
    </style>
</head>
<body>

<div id="pw_screen">
    <div id="pw_box">
        <h3>実績管理ログイン</h3>
        <input type="password" id="pass_val" style="padding:10px; font-size:16px; margin-bottom:10px;" onkeydown="if(event.keyCode==13)checkPW()">
        <br>
        <button onclick="checkPW()" style="padding:10px 20px; cursor:pointer;">ログイン</button>
        <p id="err_msg" style="color:red; display:none;">パスワードが違います</p>
    </div>
</div>

<div id="main_content">
    <h2>実績データ（生データ表示確認）</h2>
    <p id="status_msg" class="loading">データ読み込み中...</p>
    <div id="data_area"></div>
</div>

<script>
    const SHEET_ID = '1LRVwKu-YXWJvRgSophqF0VlORS5_dcjztSvfz95Qe_E';

    // ログイン処理
    function checkPW() {
        const input = document.getElementById('pass_val').value;
        if (input === "freeeks2022") {
            document.getElementById('pw_screen').style.display = 'none';
            document.getElementById('main_content').style.display = 'block';
            loadData();
        } else {
            document.getElementById('err_msg').style.display = 'block';
        }
    }

    // データ読み込み
    async function loadData() {
        const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent('実績データ')}`;
        try {
            const response = await fetch(url);
            if (!response.ok) throw new Error('Network response was not ok');
            
            const text = await response.text();
            const rows = parseCSV(text);
            
            displayRawData(rows);
            document.getElementById('status_msg').innerText = "データの取得に成功しました。";
            document.getElementById('status_msg').style.color = "green";
        } catch (e) {
            document.getElementById('status_msg').innerText = "取得失敗: " + e.message;
            document.getElementById('status_msg').style.color = "red";
        }
    }

    // CSV解析
    function parseCSV(t) {
        return t.split(/\r?\n/).filter(l => l.trim() !== "").map(l => {
            const res = []; let c = '', q = false;
            for (let ch of l) {
                if (ch === '"') q = !q;
                else if (ch === ',' && !q) { res.push(c.trim()); c = ''; }
                else c += ch;
            }
            res.push(c.trim()); return res;
        });
    }

    // 表の表示
    function displayRawData(rows) {
        let html = '<table>';
        rows.forEach((row, index) => {
            html += '<tr>';
            row.forEach(cell => {
                const tag = index === 0 ? 'th' : 'td';
                html += `<${tag}>${cell.replace(/"/g, '')}</${tag}>`;
            });
            html += '</tr>';
        });
        html += '</table>';
        document.getElementById('data_area').innerHTML = html;
    }
</script>
</body>
</html>



